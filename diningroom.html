
<!DOCTYPE html>
<html>
    <head>
        <title>left unsaid</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
        <link rel="icon" type="image/x-icon" href="favicon.ico"/>
        <link rel="preconnect" href="https://fonts.googleapis.com"> 
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="./css/room.css">
        <style>
            :root {
                --a: #0c0700;
                --b: #362300;
                --c: #aa7500;
                --d: #fdc316;
                --e: #ffe77f;
                --f: #ffe77f55;
            }
        </style>
    </head>
    <body>
        <div class="box">
            <!-- background -->
            <img class="big" id="bg" src="./imgs/2 dining room/bg.png">
            <!-- <img class="big" src="./imgs/2 dining room/ref.png" style="opacity: 30%;"> -->

            <!-- interactive items -->
            <img class="i small" id="cup1" style="top: 370px; left: 134px;" src="./imgs/2 dining room/interactive/cup1.png">
            <img class="i small" id="cup2" style="top: 327px; left: 434px;" src="./imgs/2 dining room/interactive/cup2.png">
            <img class="i small" id="cup3" style="top: 394px; left: 784px;" src="./imgs/2 dining room/interactive/cup3.png">
            <img class="i small" id="plate" style="top: 379px; left: 878px;" src="./imgs/2 dining room/interactive/plate.png">
            <img class="i small" id="pizzabox" style="top: 195px; left: 1028px;" src="./imgs/2 dining room/interactive/pizzabox.png">
            <img class="i small" id="barcart" style="top: 281px; left: 1543px;" src="./imgs/2 dining room/interactive/barcart.png">

            <!-- characters -->
            <img class="c small" id="anvi" style="top: 193px; left: 473px;" src="./imgs/2 dining room/characters/anvi.png">
            <img class="c small" id="laurenp" style="top: 132px; left: 738px;" src="./imgs/2 dining room/characters/laurenp.png">
            <img class="c small hidden" id="katrina" style="top: 240px; left: 553px;" src="./imgs/2 dining room/characters/katrina.png">

            <!-- ui -->
            <img class="u small" id="umap" style="top: 787px; left: 30px;" src="./imgs/2 dining room/ui/0 map.png">
            <img class="u small" id="uphone" style="top: 832px; left: 391px;" src="./imgs/2 dining room/ui/1 phone.png">
            <img class="u small hidden" id="uyearbook" style="top: 830px; left: 571px;" src="./imgs/2 dining room/ui/2 yearbook.png">
            <img class="u small hidden" id="ubracelet" style="top: 820px; left: 844px;" src="./imgs/2 dining room/ui/3 bracelet.png">
            <img class="u small hidden" id="uscrunchie" style="top: 834px; left: 1061px;" src="./imgs/2 dining room/ui/4 scrunchie.png">
            <img class="u small hidden" id="ulighter" style="top: 824px; left: 1297px;" src="./imgs/2 dining room/ui/5 lighter.png">
            <img class="u small hidden" id="utrash" style="top: 814px; left: 1439px;" src="./imgs/2 dining room/ui/6 trash.png">
            <img class="u small" id="usuzy" style="top: 766px; left: 1678px; padding-bottom: 0;" src="./imgs/2 dining room/ui/7 suzy.png"> 
            <div class="u small hidden" id="unosuzy" style="top: 766px; left: 1678px; padding-bottom: 0; width: 191px; height: 304px;"></div>

            <!-- dialog stuff -->
            <img class="d big hidden" id="dark" src="./imgs/2 dining room/dialog/dark.png" style="opacity: 50%">
            <img class="d big hidden" id="dmap" src="./imgs/2 dining room/dialog/dmap.png">
            <img class="d big hidden" id="dsuzy" src="./imgs/2 dining room/dialog/suzy.png">
            <img class="d big hidden" id="danvi" src="./imgs/2 dining room/dialog/anvi.png">
            <img class="d big hidden" id="dlaurenp" src="./imgs/2 dining room/dialog/laurenp.png">
            <img class="d big hidden" id="dkatrina" src="./imgs/2 dining room/dialog/katrina.png">
            <img class="d big hidden" id="textbox" src="./imgs/2 dining room/dialog/textbox.png">
            <div class="d hidden" id="text">
                <b class="d" id="charname" style="color: var(--c)">name: </b>
                <span class="d" id="dialog">placeholder text</span>
            </div>

            <!-- map -->
            <div class="d big hidden" id="rooms">
                <div class="area" title="livingroom" style="width: 295px; height: 370px; top: 65px; left: 575px;" onclick="location.href = './livingroom.html'"></div>
                <div class="area" title="diningroom" style="width: 275px; height: 370px; top: 65px; left: 875px;" onclick="location.href = './diningroom.html'"></div>
                <div class="area" title="kitchen" style="width: 198px; height: 300px; top: 165px; left: 1155px;" onclick="location.href = './kitchen.html'"></div>
                <div class="area" title="backyard" style="width: 198px; height: 95px; top: 65px; left: 1155px;" onclick="location.href = './backyard.html'"></div>
                <div class="area" title="recroom" style="width: 315px; height: 285px; top: 445px; left: 570px;" onclick="location.href = './recroom.html'"></div>
                <div class="area" title="office" style="width: 185px; height: 155px; top: 475px; left: 1170px;" onclick="location.href = './office.html'"></div>
                <div class="area" title="bathroom" style="width: 100px; height: 155px; top: 475px; left: 1065px;" onclick="location.href = './bathroom.html'"></div>
            </div>

            <!-- choices -->
            <img class="d big hidden" id="dark2" src="./imgs/2 dining room/dialog/dark.png" style="opacity: 50%">
            <div class="d choicebox hidden" id="choicebox">
                <em class="d choicehelper hidden" id="choicehelper">(click one of the dialog options to continue.)</em>
                <button class="choice hidden" id="choice0">choice0</button>
                <button class="choice hidden" id="choice1">choice1</button>
                <button class="choice hidden" id="choice2">choice2</button>
            </div>

            <!-- yearbook -->
            <img class="d big hidden" id="dark3" src="./imgs/2 dining room/dialog/dark.png" style="opacity: 50%">
            <img class="y big hidden" id="page" src="./imgs/2 dining room/yearbook/page.png">
            <img class="y big hidden" id="yellie" src="./imgs/2 dining room/yearbook/ellie.png">
            <img class="y big hidden" id="yangela" src="./imgs/2 dining room/yearbook/angela.png">
            <img class="y big hidden" id="ybrad" src="./imgs/2 dining room/yearbook/brad.png">
            <img class="y big hidden" id="yjake" src="./imgs/2 dining room/yearbook/jake.png">
            <img class="y big hidden" id="ylaurenp" src="./imgs/2 dining room/yearbook/laurenp.png">
            <img class="y big hidden" id="yanvi" src="./imgs/2 dining room/yearbook/anvi.png">
            <img class="y big hidden" id="yemily" src="./imgs/2 dining room/yearbook/emily.png">
            <img class="y big hidden" id="yryan" src="./imgs/2 dining room/yearbook/ryan.png">
            <img class="y big hidden" id="ylisa" src="./imgs/2 dining room/yearbook/lisa.png">
            <img class="y big hidden" id="ynick" src="./imgs/2 dining room/yearbook/nick.png">
            <img class="y big hidden" id="ycorey" src="./imgs/2 dining room/yearbook/corey.png">
            <img class="y big hidden" id="yrohan" src="./imgs/2 dining room/yearbook/rohan.png">
            <img class="y big hidden" id="yyasmeen" src="./imgs/2 dining room/yearbook/yasmeen.png">
            <img class="y big hidden" id="ylaurenf" src="./imgs/2 dining room/yearbook/laurenf.png">
            <img class="y big hidden" id="ykatrina" src="./imgs/2 dining room/yearbook/katrina.png">

            <!-- navbar -->
            <div class="nav">
                <a href="./">main menu</a>
                <a onclick="reset()">reset game</a>
            </div>
        </div>
    </body>
    <script
        src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous">
    </script>
    <script src="./dialog/diningroom.js"></script>
    <script src="./dialog/ui.js"></script>
    <script>
        /*** VARIABLES ***/
        // dialog generic
        let dark = document.getElementById("dark");
        let textbox = document.getElementById("textbox");
        let text = document.getElementById("text");
        let charname = document.getElementById("charname");
        let dialog = document.getElementById("dialog");
        let usuzy = document.getElementById("usuzy");
        // dialog character sprites
        let dmap = document.getElementById("dmap");
        let rooms = document.getElementById("rooms");
        let dsuzy = document.getElementById("dsuzy");
        let danvi = document.getElementById("danvi");
        let dlaurenp = document.getElementById("dlaurenp");
        let dkatrina = document.getElementById("dkatrina");
        // choices
        let dark2 = document.getElementById("dark2");
        let choicebox = document.getElementById("choicebox");
        let choicehelper = document.getElementById("choicehelper");
        let choice0 = document.getElementById("choice0");
        let choice1 = document.getElementById("choice1");
        let choice2 = document.getElementById("choice2");
        // keep track of what dialog ur on
        let currentDialog = ["", 0];

        /*** SETUP ***/
        // if first time opening this page, put vars in localStorage
        if (!localStorage.getItem("talk1")) {
            localStorage.setItem("talk1", 0); // talked to anvi
            localStorage.setItem("katrina", 0) // talked to katrina
            localStorage.setItem("trash", ""); // trash list
        }
        // change current room
        localStorage.setItem("curr", "diningroom")
        // if yearbook picked up, display in inventory
        if (localStorage.getItem("y") == 1) {
            unhide(document.getElementById("uyearbook"));
        }
        // display return item based on branch
        switch (localStorage.getItem("branch1")) {
            case "anvi":
                if (localStorage.getItem("talk1") == 0) unhide(document.getElementById("ubracelet"));
                break;
            case "ryan":
                unhide(document.getElementById("uscrunchie"));
                unhide(document.getElementById("katrina"));
                hide(document.getElementById("anvi"));
                break;
            case "lisa":
                unhide(document.getElementById("ulighter"));
                unhide(document.getElementById("katrina"));
                hide(document.getElementById("anvi"));
                break;
            default:
                break;
        }
        // hide trash already picked up
        if (localStorage.getItem("trash") != "") {
            unhide(document.getElementById("utrash"));

            let trash = localStorage.getItem("trash").split("_");
            trash.shift();
            for (let i = 0; i < trash.length; i++) {
                let t = document.getElementById(trash[i]);
                if (t) hide(t);
            }
        }
        // hide suzy if she's missing; anvi goes to look for her
        if (localStorage.getItem("suzy") != 0) {
            hide(document.getElementById("usuzy"));
            unhide(document.getElementById("unosuzy"));

            unhide(document.getElementById("katrina"));
            hide(document.getElementById("anvi"));
        }

        /*** CLICKING ***/
        $(document).click(function(event) {
            let id = $(event.target).attr('id');                 // id of clicked thing
            let cl = $(event.target).attr('class').split(/\s+/); // classlist (array)
            let val = $(event.target).attr('title');             // title/value

            // if currently on a dialog spiel
            if (cl.includes("d")) {
                if (!isHidden(dark2)) return; // if making a choice, must click one to move on
                if (!isHidden(dmap)) {
                    toggleDialog();
                    hide(dmap);
                    hide(rooms);
                    currentDialog = ["", 0];
                    return;
                }
                dialogSwitch();
                return;
            }
            // if currently making a choice
            if (cl.includes("choice")) {
                currentDialog[1] += parseInt(val);
                dialogSwitch();
                return;
            }
            // if a character
            if (cl.includes("c")) {
                switch(id) {
                    case("anvi"):
                        toggleDialog();
                        localStorage.getItem("talk1") == 0 ? anvi1(0) : anvi2(0);
                        break;
                    case("laurenp"):
                        toggleDialog();
                        laurenp1(0);
                        break;
                    case("katrina"):
                        toggleDialog();
                        let kat = localStorage.getItem("katrina");
                        kat == 0 ? katrina1(0) : (kat == 1 ? katrina2(0) : katrina3(0));
                        break;
                    default:
                        break;
                }
            }
            // if an interactive item
            if (cl.includes("i")) {
                switch(id) {
                    case("cup1"):
                        toggleDialog();
                        cup1(0);
                        break;
                    case("cup2"):
                        toggleDialog();
                        cup2(0);
                        break;
                    case("cup3"):
                        toggleDialog();
                        cup3(0);
                        break;
                    case("plate"):
                        toggleDialog();
                        plate(0);
                        break;
                    case("pizzabox"):
                        toggleDialog();
                        pizzabox(0);
                        break;
                    case("barcart"):
                        toggleDialog();
                        barcart(0);
                        break;
                    default:
                        break;
                }
            }
            // if a ui item
            if (cl.includes("u")) {
                switch(id) {
                    case("umap"):
                        toggleDialog();
                        localStorage.getItem("suzy") == 1 ? map2(0) : map(0);
                        break;
                    case("uphone"):
                        toggleDialog();
                        phone(0);
                        break;
                    case("uyearbook"):
                        toggleDialog();
                        yearbook(0);
                        break;
                    case("ubracelet"):
                        toggleDialog();
                        bracelet(0);
                        break;
                    case("uscrunchie"):
                        toggleDialog();
                        scrunchie(0);
                        break;
                    case("ulighter"):
                        toggleDialog();
                        lighter(0);
                        break;
                    case("utrash"):
                        toggleDialog();
                        trash(0);
                        break;
                    case("usuzy"):
                        toggleDialog();
                        suzy1(0);
                        break;
                    case("unosuzy"):
                        toggleDialog();
                        localStorage.getItem("suzy") == 1 ? nosuzy1(0) : nosuzy2(0);
                        break;
                    default:
                        break;
                }
            }
            // if yearbook
            if (cl.includes("y")) {
                toggleYearbook();
                currentDialog = ["", 0];
                return;
            }
        });

        /*** GENERAL FUNCTIONS ***/
        // borrowed from https://www.sitepoint.com/delay-sleep-pause-wait/
        function sleep(milliseconds) {
            const date = Date.now();
            let currentDate = null;
            do {
                currentDate = Date.now();
            } while (currentDate - date < milliseconds);
        }
        // hide/unhide items
        function hide(div) { div.classList.add("hidden"); }
        function unhide(div) { div.classList.remove("hidden"); }
        // check if div is hidden
        function isHidden(div) { return div.classList.contains("hidden"); }
        // hide/unhide dialog
        function toggleDialog() {
            console.log("toggling dialog...")
            if (isHidden(dark)) {
                console.log("dialog is hidden")
                unhide(dark);
                unhide(textbox);
                unhide(text);
                hide(usuzy);
            }
            else {
                console.log("dialog is not hidden")
                hide(dark);
                hide(textbox);
                hide(text);
                if (localStorage.getItem("suzy") == 0) unhide(usuzy);
            }
        }
        // dialog switch
        function dialogSwitch() {
            switch (currentDialog[0]) {
                    case ("anvi1"): // character
                        anvi1(currentDialog[1]);
                        break;
                    case ("anvi2"):
                        anvi2(currentDialog[1]);
                        break;
                    case ("laurenp1"):
                        laurenp1(currentDialog[1]);
                        break;
                    case("katrina1"):
                        katrina1(currentDialog[1]);
                        break;
                    case("katrina2"):
                        katrina2(currentDialog[1]);
                        break;
                    case("katrina3"):
                        katrina2(currentDialog[1]);
                        break;
                    case ("cup1"): // interactive
                        cup1(currentDialog[1]);
                        break;
                    case ("cup2"):
                        cup2(currentDialog[1]);
                        break;
                    case ("cup3"):
                        cup3(currentDialog[1]);
                        break;
                    case ("plate"):
                        plate(currentDialog[1]);
                        break;
                    case ("pizzabox"):
                        pizzabox(currentDialog[1]);
                        break;
                    case ("barcart"):
                        barcart(currentDialog[1]);
                        break;
                    case ("map"): // ui
                        map(currentDialog[1]);
                        break;
                        case ("map2"):
                        map2(currentDialog[1]);
                        break;
                    case ("phone"):
                        phone(currentDialog[1]);
                        break;
                    case ("yearbook"):
                        yearbook(currentDialog[1]);
                        break;
                    case ("bracelet"):
                        bracelet(currentDialog[1]);
                        break;
                    case ("scrunchie"):
                        scrunchie(currentDialog[1]);
                        break;
                    case ("lighter"):
                        lighter(currentDialog[1]);
                        break;
                    case ("trash"):
                        trash(currentDialog[1]);
                        break;
                    case ("suzy"):
                        suzy1(currentDialog[1]);
                        break;
                    case ("nosuzy1"):
                        nosuzy1(currentDialog[1]);
                        break;
                    case ("nosuzy2"):
                        nosuzy2(currentDialog[1]);
                        break;
                    default:
                        break;
                }
        }
        // show/hide choicebox
        function toggleChoices() {
            if (isHidden(dark2)) { unhide(dark2); unhide(choicebox); }
            else {
                hide(dark2);
                hide(choicebox);
                if (!isHidden(choice0)) hide(choice0);
                if (!isHidden(choice1)) hide(choice1);
                if (!isHidden(choice2)) hide(choice2);
            }
        }
        // extract choices
        function getChoices(str, name="") {
            toggleChoices();
            console.log("making a choice...");
            let choices = str.split("_");
            console.log(choices);
            choices.shift();
            if (localStorage.getItem("y") == 0) { // if yearbook not picked up
                for (let i = 0; i < choices.length; i++) {
                    if (choices[i].substring(0,2) != "yy") continue;
                    choices.splice(i,1);
                    break;
                }
            }
            else { // if yearbook picked up and speaker already signed
                let sigs = localStorage.getItem("sigs").split("_");
                sigs.shift();
                if (sigs.includes(name)) {
                    for (let i = 0; i < choices.length; i++) {
                    if (choices[i].substring(0,2) != "yy") continue;
                    choices.splice(i,1);
                    break;
                }
                }
            }
            for (let i = 0; i < choices.length; i++) {
                if (choices[i].substring(0,2) == "yy") choices[i] = choices[i].replace("yy","");
                choices[i] = choices[i].split("^");
                let cbox = document.getElementById("choice"+i);
                unhide(cbox);
                cbox.innerHTML = choices[i][0];
                cbox.title = choices[i][1];
            }
        }
        // hide/unhide yearbook
        function toggleYearbook() {
            isHidden(dark3) ? unhide(dark3) : hide(dark3);

            // if no signatures, simply hide/unhide blank page
            if (!localStorage.getItem("sigs")) {
                isHidden(page) ? unhide(page) : hide(page);
                return;
            }

            // hide/unhide sigs according to who's already signed
            let sigs = localStorage.getItem("sigs").split("_");
            sigs.shift();
            if (isHidden(page)) {
                unhide(page);
                for (let i = 0; i < sigs.length; i++) {
                    unhide(document.getElementById("y"+sigs[i]));
                }
            }
            else {
                hide(page);
                for (let i = 0; i < sigs.length; i++) {
                    hide(document.getElementById("y"+sigs[i]));
                }
            }
        }
        // reset game
        function reset() {
            localStorage.clear();
            location.href="./";
        }

        /*** GAMEPLAY FUNCTIONS ***/
        // character dialog
        function anvi1(n) {
            console.log("anvi1 dialog:", n);
            if (n == 0) currentDialog[0] = "anvi1"; // dialog start
            if (n == anvi1a.length) { // dialog finish
                if (!isHidden(dark2)) toggleChoices();
                hide(danvi);
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            anvi1a[n] == "ANVI:" ? unhide(danvi) : hide(danvi); // show anvi's sprite when she's talking
            if (anvi1b[n].substring(0,6) == "CHOICE") { // choice
                charname.innerHTML = "";
                dialog.innerHTML = "";
                getChoices(anvi1b[n], "ellie");
                currentDialog[1]++;
            }
            else if (anvi1b[n].substring(0,6) == "RETURN") { // return item
                hide(document.getElementById("ubracelet"));
                localStorage.setItem("talk1", 1);
                localStorage.setItem("suzy", 1);
                hide(document.getElementById("usuzy"));
                unhide(document.getElementById("unosuzy"));
                
                if (!isHidden(dark2)) toggleChoices();
                hide(danvi);
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else { // mid-dialog
                if (!isHidden(dark2)) toggleChoices();
                if (anvi1b[n].includes("^")) {
                    let dgs = anvi1b[n].split("^");
                    charname.innerHTML = anvi1a[n];
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    charname.innerHTML = anvi1a[n];
                    dialog.innerHTML = anvi1b[n];
                    currentDialog[1]++;
                }
            }
        }
        function anvi2(n) {
            console.log("anvi2 dialog:", n);
            if (n == 0) currentDialog[0] = "anvi2"; // dialog start
            if (n == anvi2a.length) { // dialog finish
                if (!isHidden(dark2)) toggleChoices();
                hide(danvi);
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            anvi2a[n] == "ANVI:" ? unhide(danvi) : hide(danvi); // show anvi's sprite when she's talking
            if (anvi2b[n].substring(0,6) == "CHOICE") { // choice
                charname.innerHTML = "";
                dialog.innerHTML = "";
                getChoices(anvi2b[n], "anvi");
                currentDialog[1]++;
            }
            else if (anvi2b[n].substring(0,4) == "SIGN") { // sign
                if (!isHidden(dark2)) toggleChoices();
                hide(danvi);
                localStorage.setItem("sigs", localStorage.getItem("sigs") + "_anvi") // add anvi's signature
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else { // mid-dialog
                if (!isHidden(dark2)) toggleChoices();
                if (anvi2b[n].includes("^")) {
                    let dgs = anvi2b[n].split("^");
                    charname.innerHTML = anvi2a[n];
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    charname.innerHTML = anvi2a[n];
                    dialog.innerHTML = anvi2b[n];
                    currentDialog[1]++;
                }
            }
        }
        function laurenp1(n) {
            console.log("laurenp1 dialog:", n);
            if (n == 0) currentDialog[0] = "laurenp1"; // dialog start
            if (n == laurenp1a.length) { // dialog finish
                if (!isHidden(dark2)) toggleChoices();
                hide(dlaurenp);
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            laurenp1a[n] == "LAUREN P.:" ? unhide(dlaurenp) : hide(dlaurenp); // show lauren p's sprite when she's talking
            if (laurenp1b[n].substring(0,6) == "CHOICE") { // choice
                charname.innerHTML = "";
                dialog.innerHTML = "";
                getChoices(laurenp1b[n], "laurenp");
                currentDialog[1]++;
            }
            else if (laurenp1b[n].substring(0,4) == "SIGN") { // sign
                if (!isHidden(dark2)) toggleChoices();
                hide(dlaurenp);
                localStorage.setItem("sigs", localStorage.getItem("sigs") + "_laurenp") // add lauren p's signature
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else { // mid-dialog
                if (!isHidden(dark2)) toggleChoices();
                if (laurenp1b[n].includes("^")) {
                    let dgs = laurenp1b[n].split("^");
                    charname.innerHTML = laurenp1a[n];
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    charname.innerHTML = laurenp1a[n];
                    dialog.innerHTML = laurenp1b[n];
                    currentDialog[1]++;
                }
            }
        }
        function katrina1(n) {
            console.log("katrina1 dialog:", n);
            if (n == 0) currentDialog[0] = "katrina1"; // dialog start
            if (n == katrina1a.length) { // dialog finish
                if (!isHidden(dark2)) toggleChoices();
                hide(dkatrina);
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            katrina1a[n] == "KAT:" ? unhide(dkatrina) : hide(dkatrina); // show kat's sprite when she's talking
            if (katrina1b[n].substring(0,6) == "CHOICE") { // choice
                charname.innerHTML = "";
                dialog.innerHTML = "";
                getChoices(katrina1b[n], "katrina");
                currentDialog[1]++;
            }
            else if (katrina1b[n].substring(0,4) == "SIGN") { // sign
                if (!isHidden(dark2)) toggleChoices();
                hide(dkatrina);
                localStorage.setItem("sigs", localStorage.getItem("sigs") + "_katrina") // add kat's signature
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else { // mid-dialog
                if (!isHidden(dark2)) toggleChoices();
                if (katrina1b[n].includes("^")) {
                    let dgs = katrina1b[n].split("^");
                    charname.innerHTML = katrina1a[n];
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    charname.innerHTML = katrina1a[n];
                    dialog.innerHTML = katrina1b[n];
                    currentDialog[1]++;
                }
            }
        }
        function katrina2(n) {
            console.log("katrina2 dialog:", n);
            if (n == 0) currentDialog[0] = "katrina2"; // dialog start
            if (n == katrina2a.length) { // dialog finish
                if (!isHidden(dark2)) toggleChoices();
                hide(dkatrina);
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            katrina2a[n] == "KAT:" ? unhide(dkatrina) : hide(dkatrina); // show kat's sprite when she's talking
            if (katrina2b[n].substring(0,6) == "CHOICE") { // choice
                charname.innerHTML = "";
                dialog.innerHTML = "";
                getChoices(katrina2b[n], "katrina");
                currentDialog[1]++;
            }
            else if (katrina2b[n].substring(0,4) == "SIGN") { // sign
                if (!isHidden(dark2)) toggleChoices();
                hide(dkatrina);
                localStorage.setItem("sigs", localStorage.getItem("sigs") + "_katrina") // add kat's signature
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else { // mid-dialog
                if (!isHidden(dark2)) toggleChoices();
                if (katrina2b[n].includes("^")) {
                    let dgs = katrina2b[n].split("^");
                    charname.innerHTML = katrina2a[n];
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    charname.innerHTML = katrina2a[n];
                    dialog.innerHTML = katrina2b[n];
                    currentDialog[1]++;
                }
            }
        }
        function katrina3(n) {
            console.log("katrina3 dialog:", n);
            if (n == 0) currentDialog[0] = "katrina3"; // dialog start
            if (n == katrina3a.length) { // dialog finish
                if (!isHidden(dark2)) toggleChoices();
                hide(dkatrina);
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            katrina3a[n] == "KAT:" ? unhide(dkatrina) : hide(dkatrina); // show kat's sprite when she's talking
            if (katrina3b[n].substring(0,6) == "CHOICE") { // choice
                charname.innerHTML = "";
                dialog.innerHTML = "";
                getChoices(katrina3b[n], "katrina");
                currentDialog[1]++;
            }
            else if (katrina3b[n].substring(0,4) == "SIGN") { // sign
                if (!isHidden(dark2)) toggleChoices();
                hide(dkatrina);
                localStorage.setItem("sigs", localStorage.getItem("sigs") + "_katrina") // add kat's signature
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else { // mid-dialog
                if (!isHidden(dark2)) toggleChoices();
                if (katrina3b[n].includes("^")) {
                    let dgs = katrina3b[n].split("^");
                    charname.innerHTML = katrina3a[n];
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    charname.innerHTML = katrina3a[n];
                    dialog.innerHTML = katrina3b[n];
                    currentDialog[1]++;
                }
            }
        }
        // interactive item dialog
        function cup1(n) {
            console.log("cup1 dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "cup1";
            if (n == cup1a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else if (cup1a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(cup1a[n]);
                currentDialog[1]++;
            }
            else if (cup1a[n].substring(0,6) == "PICKUP") {
                hide(document.getElementById("cup1"));
                localStorage.setItem("trash", localStorage.getItem("trash") + "_cup1");
                if (isHidden(document.getElementById("utrash"))) unhide(document.getElementById("utrash"));

                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (cup1a[n].includes("^")) {
                    let dgs = cup1a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = cup1a[n];
                    currentDialog[1]++;
                }
            }
        }
        function cup2(n) {
            console.log("cup2 dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "cup2";
            if (n == cup2a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else if (cup2a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(cup2a[n]);
                currentDialog[1]++;
            }
            else if (cup2a[n].substring(0,6) == "PICKUP") {
                hide(document.getElementById("cup2"));
                localStorage.setItem("trash", localStorage.getItem("trash") + "_cup2");
                if (isHidden(document.getElementById("utrash"))) unhide(document.getElementById("utrash"));

                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (cup2a[n].includes("^")) {
                    let dgs = cup2a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = cup2a[n];
                    currentDialog[1]++;
                }
            }
        }
        function cup3(n) {
            console.log("cup3 dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "cup3";
            if (n == cup3a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else if (cup3a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(cup3a[n]);
                currentDialog[1]++;
            }
            else if (cup3a[n].substring(0,6) == "PICKUP") {
                hide(document.getElementById("cup3"));
                localStorage.setItem("trash", localStorage.getItem("trash") + "_cup3");
                if (isHidden(document.getElementById("utrash"))) unhide(document.getElementById("utrash"));

                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (cup3a[n].includes("^")) {
                    let dgs = cup3a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = cup3a[n];
                    currentDialog[1]++;
                }
            }
        }
        function plate(n) {
            console.log("plate dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "plate";
            if (n == plate1a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else if (plate1a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(plate1a[n]);
                currentDialog[1]++;
            }
            else if (plate1a[n].substring(0,9) == "[ you eat") {
                if (!isHidden(dark2)) toggleChoices();
                hide(document.getElementById("plate"));
                dialog.innerHTML = plate1a[n];
                currentDialog[1]++;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (plate1a[n].includes("^")) {
                    let dgs = plate1a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = plate1a[n];
                    currentDialog[1]++;
                }
            }
        }
        function pizzabox(n) {
            console.log("pizzabox dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "pizzabox";
            if (n == pizzabox1a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else if (pizzabox1a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(pizzabox1a[n]);
                currentDialog[1]++;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (pizzabox1a[n].includes("^")) {
                    let dgs = pizzabox1a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = pizzabox1a[n];
                    currentDialog[1]++;
                }
            }
        }
        // ui dialog
        function map(n) {
            console.log("map dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "map";
            if (n == map1a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            if (map1a[n] == "MAP") {
                unhide(dmap);
                unhide(rooms);
                dialog.innerHTML = "(click a room to go there. click anywhere else to exit.)";
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (map1a[n].includes("^")) {
                    let dgs = map1a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = map1a[n];
                    currentDialog[1]++;
                }
            } 
        }
        function map2(n) {
            console.log("map2 dialog:", n);
            charname.innerHTML = "";
            
            if (n == 0) {
                currentDialog[0] = "map2";
                dialog.innerHTML = "[ something doesn't feel right... ]";
                currentDialog[1]++;
            }
            if (n == 1) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
        }
        function phone(n) {
            console.log("phone dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "phone";
            if (n == phone1a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            if (phone1a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(phone1a[n]);
                currentDialog[1]++;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (phone1a[n].includes("^")) {
                    let dgs = phone1a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = phone1a[n];
                    currentDialog[1]++;
                }
            } 
        }
        function yearbook(n) {
            console.log("yearbook dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "yearbook";
            if (n == yearbook2a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            if (yearbook2a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(yearbook2a[n]);
                currentDialog[1]++;
            }
            else if (yearbook2a[n].substring(0,4) == "SIGS") {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                toggleYearbook();
                currentDialog = ["", 0];
                return;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (yearbook2a[n].includes("^")) {
                    let dgs = yearbook2a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = yearbook2a[n];
                    currentDialog[1]++;
                }
            } 
        }
        function bracelet(n) {
            console.log("bracelet dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "bracelet";
            if (n == bracelet1a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            if (bracelet1a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(bracelet1a[n]);
                currentDialog[1]++;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (bracelet1a[n].includes("^")) {
                    let dgs = bracelet1a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = bracelet1a[n];
                    currentDialog[1]++;
                }
            } 
        }
        function scrunchie(n) {
            console.log("scrunchie dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "scrunchie";
            if (n == scrunchie1a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            if (scrunchie1a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(scrunchie1a[n]);
                currentDialog[1]++;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (scrunchie1a[n].includes("^")) {
                    let dgs = scrunchie1a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = scrunchie1a[n];
                    currentDialog[1]++;
                }
            } 
        }
        function lighter(n) {
            console.log("lighter dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "lighter";
            if (n == lighter1a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            if (lighter1a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(lighter1a[n]);
                currentDialog[1]++;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (lighter1a[n].includes("^")) {
                    let dgs = lighter1a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    dialog.innerHTML = lighter1a[n];
                    currentDialog[1]++;
                }
            } 
        }
        function trash(n) {
            console.log("trash dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "trash";
            if (n == trash1a.length) {
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            if (trash1a[n].substring(0,6) == "CHOICE") {
                dialog.innerHTML = "";
                getChoices(trash1a[n]);
                currentDialog[1]++;
            }
            else {
                if (!isHidden(dark2)) toggleChoices();
                if (trash1a[n].includes("^")) {
                    let dgs = trash1a[n].split("^");
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    let dg = trash1a[n];
                    if (dg.includes("###")) {
                        let trash = localStorage.getItem("trash").split("_");
                        let amt = trash.length-1;
                        dg = dg.replace("###", amt);
                    }
                    dialog.innerHTML = dg;
                    currentDialog[1]++;
                }
            } 
        }
        function suzy1(n) {
            console.log("suzy1 dialog:", n);
            if (n == 0) currentDialog[0] = "suzy"; // dialog start
            if (n == suzy1a.length) { // dialog finish
                if (!isHidden(dark2)) toggleChoices();
                hide(choicehelper);
                hide(dsuzy);
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            suzy1a[n] == "SUZY:" ? unhide(dsuzy) : hide(dsuzy); // show suzy's sprite when she's talking
            if (suzy1b[n].substring(0,6) == "CHOICE") { // choice
                charname.innerHTML = "";
                dialog.innerHTML = "";
                getChoices(suzy1b[n]);
                currentDialog[1]++;
            }
            else { // mid-dialog
                if (!isHidden(dark2)) toggleChoices();
                if (suzy1b[n].includes("^")) {
                    let dgs = suzy1b[n].split("^");
                    charname.innerHTML = suzy1a[n];
                    dialog.innerHTML = dgs[0];
                    currentDialog[1] += parseInt(dgs[1]);
                }
                else {
                    charname.innerHTML = suzy1a[n];
                    dialog.innerHTML = suzy1b[n];
                    currentDialog[1]++;
                }
            }
        }
        function nosuzy1(n) {
            console.log("nosuzy1 dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "nosuzy1"; // dialog start
            if (n == nosuzy1a.length) { // dialog finish
                localStorage.setItem("suzy", 2);

                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else { // mid-dialog
                dialog.innerHTML = nosuzy1a[n];
                currentDialog[1]++;
            }
        }
        function nosuzy2(n) {
            console.log("nosuzy2 dialog:", n);
            charname.innerHTML = "";
            if (n == 0) currentDialog[0] = "nosuzy2"; // dialog start
            if (n == nosuzy2a.length) { // dialog finish
                if (!isHidden(dark2)) toggleChoices();
                toggleDialog();
                currentDialog = ["", 0];
                return;
            }
            else { // mid-dialog
                dialog.innerHTML = nosuzy2a[n];
                currentDialog[1]++;
            }
        }
   </script>
</html>